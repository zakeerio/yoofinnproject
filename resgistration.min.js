var db=firebase.firestore();function init(){$(".droppable-area1, .droppable-area2").sortable({connectWith:".connected-sortable",stack:".connected-sortable"}).disableSelection(),firebase.auth().onAuthStateChanged(function(e){e?(e.displayName,e.email,e.emailVerified,e.photoURL,e.isAnonymous,e.uid,e.providerData,localStorage.setItem("userdata",JSON.stringify(e)),$(".registration").addClass("hide"),setTimeout(function(){$("#reg-step2").removeClass("hide")},2500)):(setTimeout(function(){$("#reg-step1").removeClass("hide")},2500),console.log("user logged out!"))})}function writeNewPost(e,t,a,o){console.log(e);a={id:e,email:o,fschoolname:t,lschoolname:a};db.collection("Users").doc(e).set(a).then(()=>($(".registration").addClass("hide"),$("#reg-step2").removeClass("hide"),console.log("users data added successfully"),!0))}$(init),$("#declineterms").on("click",function(){$("#termsconditions").addClass("hide"),$("#terms").attr("data-accept",!1),$(".checkbox-field").trigger("click",function(){return!1}),$("#agreecontinue").addClass("disabled")}),$("#acceptterms").on("click",function(){$("#termsconditions").addClass("hide"),$("#terms").attr("data-accept",!0),$("#agreecontinue").removeClass("disabled")}),$(document).ready(function(){$(".date-picker").datepicker({changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFormat:"mm/yy",onClose:function(e,t){$(this).datepicker("setDate",new Date(t.selectedYear,t.selectedMonth,1))}})}),$("#agreecontinue").on("click",function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return!1;var t="";$("#errors").html(""),$("input[type=text], input[type=email]").removeClass("error");var a=$("#email").val(),o=$("#Confirm-Email").val(),s=$("#password").val(),i=$("#name").val(),l=$("#Last-Name").val(),e=$("#terms").prop("checked");if($("#email").removeClass("error"),""==i&&($("#name").addClass("error"),t+="<li>Please enter First name</li>"),""==l&&($("#Last-Name").addClass("error"),t+="<li>Please enter Last name</li>"),""==a&&($("#email").addClass("error"),t+="<li>Please enter value in email field</li>"),""==o&&($("#Confirm-Email").addClass("error"),t+="<li>Please enter value in confirm email field</li>"),(s.length<4||""==s)&&($("#password").addClass("error"),t+="<li>Please enter a password</li>"),""!=a&&""!=o&&a!=o&&($("#email").addClass("error"),$("#Confirm-Email").addClass("error"),t+="<li>Email field doesn't match</li>"),e||(t+="<li>You must agree to terms and conditions before submit the form</li>"),""!=t)return t="<h4>Errors!</h4>"+t,$("#errors").html(t).removeClass("hide"),!1;firebase.auth().createUserWithEmailAndPassword(a,s).then(e=>{e=e.user;localStorage.setItem("userdata",JSON.stringify(e)),console.log(e),userId=e.uid;e=e.email;""!=i&&""!=l&&writeNewPost(userId,i,l,e)&&($(".registration").addClass("hide"),$("#reg-step2").removeClass("hide"))}).catch(e=>{e.code;e=e.message;$("#errors").html(e)})}),$("#terms").on("change",function(){1==$(this).is(":checked")?$("#termsconditions").removeClass("hide"):$("#termsconditions").addClass("hide")}),$(".add-school").click(function(){$(".addschool_field").removeClass("hide")}),$("#step-back-2").on("click",function(){$(".registration").addClass("hide"),$("#reg-step1").removeClass("hide")}),$("#step-back-3").on("click",function(){$(".registration").addClass("hide"),$("#reg-step2").removeClass("hide")}),$("#step-back-4").on("click",function(){$(".registration").addClass("hide"),$("#reg-step3").removeClass("hide")}),$("#addschool").on("click",function(){$("#addschoolbox").removeClass("hide")}),$(".closebutton").click(function(){$("#wf-form-Add-School")[0].reset(),$("#addschoolbox").addClass("hide")});var states="";db.collection("States").orderBy("name").get().then(e=>{e.forEach(e=>{statedata=e.data(),states+="<option value='"+statedata.postalAbreviation+"'>"+statedata.name+"</option>"}),$("#states").html(states)}),$("#addschoolbtn").on("click",function(){var o=localStorage.getItem("userdata"),o=JSON.parse(o);db.collection("Users").doc(o.uid).get().then(e=>{e=e.data();if(e.schoolid)return console.log(e.schoolid),!1;console.log("Not found!");var t="";if($("#wf-form-Add-School input").each(function(){""==$(this).val()&&(t+="Please fill "+$(this).attr("data-name")+" field\n")}),""==$("#states").val()&&(t+="Please fill "+$("#states").attr("data-name")+" field\n"),""!=t)return alert(t),!1;var e=$("input[name=schoolname]").val().split(" "),e={city:$("input[name=city]").val(),schoolname:$("input[name=schoolname]").val(),state:$("select[name=state]").val(),zip:$("input[name=zipcode]").val(),schoolkeywords:e},a=db.collection("Schools").doc();a.set(e).then(()=>{userschool={schoolid:a.id},db.collection("Users").doc(o.uid).update(userschool).then(()=>{console.log("user successfully updated!")})})})}),$(function(){$(".input_addschool_field").autocomplete({source:function(e,t){console.log(e.term);var a=[],e=e.term.split(" ");db.collection("Schools").where("schoolkeywords","array-contains-any",e).limit(15).get().then(e=>{console.log(e.size),0<e.size?e.forEach(e=>{statedata=e.data();e={id:e.id,value:e.data().schoolname};a.push(e)}):(school_item={value:"",label:"Not Found"},a.push(school_item)),console.log(a),t(a)}).catch(e=>{console.error("No results found: ",e)})},minLength:2,select:function(e,t){"Not Found"==t.item.value?$(this).removeAttr("data-id"):($(this).attr("data-id",t.item.id),console.log(t.item))},error:function(e){$('.input_addschool_field"').removeClass("ui-autocomplete-loading")}})});